<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paint App</title>
    <link rel="stylesheet" href="style.css">
    <!-- Optimized: No External Frameworks -->
</head>
<body>
    <div class="game-container">
        <div class="game-content">

    <h1>Paint App</h1>
    <div class="toolbar">
        <div class="tool-group">
            <label for="colorPicker">Farbe:</label>
            <input type="color" id="colorPicker" value="#000000">
        </div>
        <div class="tool-group">
            <label for="brushSize">Größe:</label>
            <input type="range" id="brushSize" min="1" max="50" value="5">
            <span id="brushSizeValue">5px</span>
        </div>
        <div class="tool-group">
            <button class="clear-btn" id="clearBtn">Alles löschen</button>
            <button id="saveBtn">Speichern</button>
        </div>
    </div>
    <canvas id="drawingCanvas"></canvas>

    <script>
        const canvas = document.getElementById('drawingCanvas');
        const ctx = canvas.getContext('2d');
        const colorPicker = document.getElementById('colorPicker');
        const brushSize = document.getElementById('brushSize');
        const brushSizeValue = document.getElementById('brushSizeValue');
        const clearBtn = document.getElementById('clearBtn');
        const saveBtn = document.getElementById('saveBtn');

        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;

        function resizeCanvas() {
            const containerWidth = Math.min(window.innerWidth - 40, 800);
            const containerHeight = Math.min(window.innerHeight - 200, 600);

            // Save current content
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = canvas.width;
            tempCanvas.height = canvas.height;
            const tempCtx = tempCanvas.getContext('2d');
            if (canvas.width > 0 && canvas.height > 0) {
                 tempCtx.drawImage(canvas, 0, 0);
            }

            canvas.width = containerWidth;
            canvas.height = containerHeight;

            // Restore content
            ctx.drawImage(tempCanvas, 0, 0);

            // Set styles again as resizing clears context
            ctx.lineJoin = 'round';
            ctx.lineCap = 'round';
            ctx.strokeStyle = colorPicker.value;
            ctx.lineWidth = brushSize.value;
        }

        // Initialize canvas size
        // We need to set initial size but also keep content on resize?
        // For simple app, maybe just clear on resize or better, set fixed size but responsive via CSS?
        // Let's try to set size once on load.
        canvas.width = Math.min(window.innerWidth - 40, 800);
        canvas.height = Math.min(window.innerHeight - 200, 600);
        ctx.lineJoin = 'round';
        ctx.lineCap = 'round';
        ctx.lineWidth = 5;

        // Mouse Events
        canvas.addEventListener('mousedown', (e) => {
            isDrawing = true;
            [lastX, lastY] = [e.offsetX, e.offsetY];
        });

        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('mouseup', () => isDrawing = false);
        canvas.addEventListener('mouseout', () => isDrawing = false);

        // Touch Events
        canvas.addEventListener('touchstart', (e) => {
            isDrawing = true;
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            [lastX, lastY] = [touch.clientX - rect.left, touch.clientY - rect.top];
        }, { passive: true });

        canvas.addEventListener('touchmove', (e) => {
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            draw({
                offsetX: touch.clientX - rect.left,
                offsetY: touch.clientY - rect.top
            });
        }, { passive: true });

        canvas.addEventListener('touchend', () => isDrawing = false, { passive: true });

        function draw(e) {
            if (!isDrawing) return;

            ctx.beginPath();
            ctx.moveTo(lastX, lastY);
            ctx.lineTo(e.offsetX, e.offsetY);
            ctx.stroke();

            [lastX, lastY] = [e.offsetX, e.offsetY];
        }

        // Tools
        colorPicker.addEventListener('change', (e) => ctx.strokeStyle = e.target.value);

        brushSize.addEventListener('input', (e) => {
            ctx.lineWidth = e.target.value;
            brushSizeValue.textContent = `${e.target.value}px`;
        });

        clearBtn.addEventListener('click', () => {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        });

        saveBtn.addEventListener('click', () => {
            const link = document.createElement('a');
            link.download = 'mein-kunstwerk.png';
            link.href = canvas.toDataURL();
            link.click();
        });

        // Handle resize slightly gracefully (optional)
        // window.addEventListener('resize', resizeCanvas);
    </script>

        </div>
    </div>

    <script>
        // Responsive Game Handler
        class ResponsiveGameHandler {
          constructor() {
            this.container = document.body;
            this.init();
          }

          init() {
            this.detectContainerSize();
            this.adjustGameLayout();
            window.addEventListener('resize', () => this.adjustGameLayout());
          }

          detectContainerSize() {
            const width = window.innerWidth;
            const height = window.innerHeight;

            if (width <= 500 || height <= 250) {
              document.body.classList.add('compact-mode');
            } else {
              document.body.classList.remove('compact-mode');
            }

            if (width <= 320) {
              document.body.classList.add('mobile-mode');
            } else {
              document.body.classList.remove('mobile-mode');
            }
          }

          adjustGameLayout() {
            this.scaleGameElements();
          }

          scaleGameElements() {
            const container = document.querySelector('.game-container');
            if (!container) return;

            const containerWidth = container.offsetWidth;
            const containerHeight = container.offsetHeight;
            const gameContent = document.querySelector('.game-content');

            if (!gameContent) return;

            // Base dimensions
            const baseWidth = 600;
            const baseHeight = 600;

            const scaleX = Math.min(1, containerWidth / baseWidth);
            const scaleY = Math.min(1, containerHeight / baseHeight);
            const scale = Math.min(scaleX, scaleY);

            if (scale < 0.95) {
                gameContent.style.transform = `scale(${scale})`;
            } else {
                gameContent.style.transform = 'none';
            }
          }
        }

        document.addEventListener('DOMContentLoaded', () => {
          new ResponsiveGameHandler();
        });
    </script>

</body>
</html>
