<!doctype html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>To-Do Liste</title>
    <meta
      name="description"
      content="Produktivit√§ts-Tool zum Verwalten von Aufgaben. Erstelle, bearbeite und organisiere deine To-Dos."
    />
    <link rel="stylesheet" href="style.css" />
    <!-- Optimized: No External Frameworks -->
    <link rel="stylesheet" href="../../card-integration.css" />
    <script src="../../card-fit.js" defer></script>
  </head>
  <body>
    <div class="todo-container">
      <h1>üìù To-Do Liste</h1>

      <div class="input-section">
        <input
          type="text"
          class="todo-input"
          id="todoInput"
          placeholder="Neue Aufgabe hinzuf√ºgen..."
        />
        <button class="add-btn" onclick="addTodo()">‚ûï Hinzuf√ºgen</button>
      </div>

      <div class="filter-section">
        <button class="filter-btn active" onclick="filterTodos('all')">
          Alle
        </button>
        <button class="filter-btn" onclick="filterTodos('active')">
          Aktiv
        </button>
        <button class="filter-btn" onclick="filterTodos('completed')">
          Erledigt
        </button>
      </div>

      <div class="stats">
        <div class="stat-item">
          <span class="stat-number" id="totalTodos">0</span>
          Gesamt
        </div>
        <div class="stat-item">
          <span class="stat-number" id="activeTodos">0</span>
          Aktiv
        </div>
        <div class="stat-item">
          <span class="stat-number" id="completedTodos">0</span>
          Erledigt
        </div>
      </div>

      <div class="todo-list" id="todoList">
        <div class="empty-state">
          <div class="empty-state-icon">üìã</div>
          <div>Keine Aufgaben vorhanden</div>
          <div style="font-size: 0.9rem; margin-top: 0.5rem; opacity: 0.7">
            F√ºge deine erste Aufgabe hinzu!
          </div>
        </div>
      </div>
    </div>

    <script>
      let todos = JSON.parse(localStorage.getItem("todos")) || [];
      let currentFilter = "all";
      let nextId = Math.max(...todos.map((t) => t.id), 0) + 1;

      function saveTodos() {
        localStorage.setItem("todos", JSON.stringify(todos));
      }

      function addTodo() {
        const input = document.getElementById("todoInput");
        const text = input.value.trim();

        if (text === "") return;

        const todo = {
          id: nextId++,
          text: text,
          completed: false,
          createdAt: new Date().toISOString(),
        };

        todos.unshift(todo);
        input.value = "";
        saveTodos();
        renderTodos();
        updateStats();
      }

      function toggleTodo(id) {
        const todo = todos.find((t) => t.id === id);
        if (todo) {
          todo.completed = !todo.completed;
          saveTodos();
          renderTodos();
          updateStats();
        }
      }

      function deleteTodo(id) {
        todos = todos.filter((t) => t.id !== id);
        saveTodos();
        renderTodos();
        updateStats();
      }

      function editTodo(id) {
        const todo = todos.find((t) => t.id === id);
        if (todo) {
          const newText = prompt("Aufgabe bearbeiten:", todo.text);
          if (newText !== null && newText.trim() !== "") {
            todo.text = newText.trim();
            saveTodos();
            renderTodos();
          }
        }
      }

      function filterTodos(filter) {
        currentFilter = filter;

        // Update filter buttons
        document.querySelectorAll(".filter-btn").forEach((btn) => {
          btn.classList.remove("active");
        });
        event.target.classList.add("active");

        renderTodos();
      }

      function getFilteredTodos() {
        switch (currentFilter) {
          case "active":
            return todos.filter((t) => !t.completed);
          case "completed":
            return todos.filter((t) => t.completed);
          default:
            return todos;
        }
      }

      function renderTodos() {
        const todoList = document.getElementById("todoList");
        const filteredTodos = getFilteredTodos();

        if (filteredTodos.length === 0) {
          let emptyMessage = "Keine Aufgaben vorhanden";
          if (currentFilter === "active")
            emptyMessage = "Keine aktiven Aufgaben";
          if (currentFilter === "completed")
            emptyMessage = "Keine erledigten Aufgaben";

          todoList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìã</div>
                        <div>${emptyMessage}</div>
                    </div>
                `;
          return;
        }

        todoList.innerHTML = filteredTodos
          .map(
            (todo) => `
                <div class="todo-item ${todo.completed ? "completed" : ""}">
                    <div class="todo-checkbox ${todo.completed ? "checked" : ""}" 
                         onclick="toggleTodo(${todo.id})"></div>
                    <div class="todo-text">${todo.text}</div>
                    <div class="todo-actions">
                        <button class="action-btn" onclick="editTodo(${todo.id})">‚úèÔ∏è</button>
                        <button class="action-btn delete-btn" onclick="deleteTodo(${todo.id})">üóëÔ∏è</button>
                    </div>
                </div>
            `,
          )
          .join("");
      }

      function updateStats() {
        const total = todos.length;
        const active = todos.filter((t) => !t.completed).length;
        const completed = todos.filter((t) => t.completed).length;

        document.getElementById("totalTodos").textContent = total;
        document.getElementById("activeTodos").textContent = active;
        document.getElementById("completedTodos").textContent = completed;
      }

      // Enter key support
      document
        .getElementById("todoInput")
        .addEventListener("keypress", function (e) {
          if (e.key === "Enter") {
            addTodo();
          }
        });

      // Initialize app
      renderTodos();
      updateStats();
    </script>
  </body>
</html>
